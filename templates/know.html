{% extends "_layout.html" %}
{% block title %}Know â€” CodeCrafter{% endblock %}
{% block content %}
<h1 class="cc-h1">Know</h1>
<form id="question-form" method="post" class="cc-form">
  <label for="question-input">Question</label>
  <div style="display:flex; gap:0.5rem; align-items:flex-start;">
    <input id="question-input" name="question" type="text" class="cc-input" placeholder="Ask something about the projectâ€¦" required style="flex:1;" />
    <button type="button" class="cc-btn" aria-label="Speak question" onclick="voice.startListening()">ðŸŽ¤</button>
    <button id="ask-btn" class="cc-btn cc-btn--primary" type="submit">Ask</button>
  </div>
</form>

<div class="cc-card" style="margin-top:1.5rem;">
  <h2>Answer</h2>
  <div id="answer-body" class="cc-body">(answer appears here)</div>
  <h3>Sources</h3>
  <ul id="answer-sources"></ul>
</div>

<script>
const form = document.getElementById('question-form');
form.addEventListener('submit', async (event)=>{
  event.preventDefault();
  const fd = new FormData(form);
  const r = await fetch('/api/know', { method:'POST', body:fd });
  const j = await r.json();
  document.getElementById('answer-body').textContent = j.answer;
  document.getElementById('answer-sources').innerHTML = j.sources.map(s=>`<li>${s}</li>`).join('');
  if (j.answer) voice.speak(j.answer);
});
</script>
<script src="{{ url_for('static', filename='js/voice.js') }}"></script>
{% endblock %}
