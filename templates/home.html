{% extends "_layout.html" %}
{% block title %}Home â€” CodeCrafter{% endblock %}
{% block content %}
<style>
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    background: #050608;
    position: sticky;
    top: 0;
    z-index: 10;
    margin: -1.25rem -1.25rem 1.5rem -1.25rem;
  }
  .topbar .brand {
    font-size: 1.25rem;
    font-weight: 600;
    color: #e0f2f1;
  }
  .voice-btn {
    background: #00b894;
    border: none;
    border-radius: 999px;
    padding: 0.6rem 1.1rem;
    font-size: 1rem;
    color: #021316;
    cursor: pointer;
    box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.6);
    transition: box-shadow 0.2s ease, transform 0.1s ease;
  }
  .voice-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 0 0 6px rgba(0, 184, 148, 0.25);
  }
  .voice-cta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.15rem;
  }
  .voice-hint {
    font-size: 0.85rem;
    color: #8abbb5;
  }
  .topbar-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  .user-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #c7d2d9;
  }
  .user-status a {
    color: #7de2d1;
  }
</style>

<header class="topbar">
  <div class="brand">CodeCrafter Office</div>
  <div class="topbar-actions">
    <div class="user-status">
      {% if current_user %}
        <span>Signed in as {{ current_user.username }} ({{ get_current_role() }})</span>
        <a href="{{ url_for('logout') }}" class="link-small">Logout</a>
      {% else %}
        <a href="{{ url_for('login') }}" class="link-small">Login</a>
      {% endif %}
    </div>
    <div class="voice-cta">
      <button id="voice-command-btn" class="voice-btn" title="Talk to CodeCrafter">ğŸ™</button>
      <div class="voice-hint">Try saying â€œopen rosterâ€ or â€œask Know about todayâ€™s flightsâ€.</div>
    </div>
  </div>
</header>

<h1 class="cc-h1">Welcome</h1>
<div class="cc-grid cc-grid-3">
  <div class="cc-card">
    <div class="cc-card-icon" aria-hidden="true">ğŸ§±</div>
    <h2>Build</h2>
    <p>Plan â†’ Scaffold â†’ Test â†’ Package</p>
    <div class="cc-card-actions">
      <a href="{{ url_for('build') }}" class="cc-btn cc-btn--primary">Start</a>
    </div>
  </div>
  <div class="cc-card">
    <div class="cc-card-icon" aria-hidden="true">ğŸ©¹</div>
    <h2>Fix</h2>
    <p>Submit error & snippet, get a patch</p>
    <div class="cc-card-actions">
      <a href="{{ url_for('fix') }}" class="cc-btn cc-btn--primary">Start</a>
    </div>
  </div>
  <div class="cc-card">
    <div class="cc-card-icon" aria-hidden="true">ğŸ”</div>
    <h2>Know</h2>
    <p>Ask questions, get sourced answers</p>
    <div class="cc-card-actions">
      <a href="{{ url_for('know') }}" class="cc-btn cc-btn--primary">Start</a>
    </div>
  </div>
  <div class="cc-card">
    <div class="cc-card-icon" aria-hidden="true">ğŸ‘¥</div>
    <h2>Roster</h2>
    <p>View crew roles and shift coverage</p>
    <div class="cc-card-actions">
      <a href="{{ url_for('roster_page') }}" class="cc-btn cc-btn--primary">Open</a>
    </div>
  </div>
  <div class="cc-card">
    <div class="cc-card-icon" aria-hidden="true">âœˆï¸</div>
    <h2>Schedule</h2>
    <p>Review upcoming flight arrivals</p>
    <div class="cc-card-actions">
      <a href="{{ url_for('schedule_page') }}" class="cc-btn cc-btn--primary">Open</a>
    </div>
  </div>
  <div class="cc-card">
    <div class="cc-card-icon" aria-hidden="true">ğŸ› ï¸</div>
    <h2>Maintenance</h2>
    <p>Check truck service readiness</p>
    <div class="cc-card-actions">
      <a href="{{ url_for('maintenance_page') }}" class="cc-btn cc-btn--primary">Open</a>
    </div>
  </div>
  <div class="cc-card">
    <div class="cc-card-icon" aria-hidden="true">ğŸ–¥ï¸</div>
    <h2>Machine Room</h2>
    <p>DB &amp; system overview (supervisors only).</p>
    <span class="cc-pill">Requires supervisor login</span>
    <div class="cc-card-actions">
      {% set current_role = get_current_role() %}
      {% if current_role == 'supervisor' %}
        <a href="{{ url_for('machine_room') }}" class="cc-btn cc-btn--primary">Open</a>
      {% else %}
        <a href="{{ url_for('machine_room') }}" class="cc-btn cc-btn--primary" aria-disabled="true">Requires Supervisor</a>
      {% endif %}
    </div>
  </div>
</div>

<script>
  const voiceBtn = document.getElementById("voice-command-btn");
  if (voiceBtn && window.voice) {
    voiceBtn.addEventListener("click", () => {
      if (window.voice.startAssistantFlow) {
        window.voice.startAssistantFlow();
      }
    });
  }
</script>
{% endblock %}
