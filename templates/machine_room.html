{% extends "_layout.html" %}
{% block title %}Machine Room — Office Manager{% endblock %}
{% block content %}
<style>
  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1rem; }
  .card { background: var(--elev); border: 1px solid var(--line); border-radius: var(--radius); padding: var(--pad); box-shadow: var(--shadow); }
  .muted { color: var(--muted); }
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 0.5rem; border-bottom: 1px solid var(--line); text-align: left; }
  th { color: var(--muted); font-weight: 600; }
</style>

<h1 class="cc-h1">Machine Room</h1>
<p class="muted">Quick system snapshot for supervisors and admins.</p>

<div class="grid" aria-label="Database overview">
  <div class="card">
    <h2>Database</h2>
    <p><strong>Type:</strong> {{ db_type }}</p>
    <p><strong>URI:</strong> {{ db_uri[:80] }}{% if db_uri|length > 80 %}…{% endif %}</p>
  </div>
  <div class="card">
    <h2>Counts</h2>
    <p><strong>Employees:</strong> {{ employee_count }}</p>
    <p><strong>Flights:</strong> {{ flight_count }}</p>
    <p><strong>Maintenance items:</strong> {{ maintenance_count }}</p>
    <p><strong>Audit events:</strong> {{ audit_count }}</p>
  </div>
</div>

<div class="grid" style="margin-top: 1rem;" aria-label="Recent activity">
  <div class="card">
    <h3>Recent Employees</h3>
    <table>
      <thead>
        <tr><th>Name</th><th>Role</th><th>Shift</th></tr>
      </thead>
      <tbody>
        {% for emp in recent_employees %}
          <tr>
            <td>{{ emp.name }}</td>
            <td>{{ emp.role }}</td>
            <td>{{ emp.shift }}</td>
          </tr>
        {% else %}
          <tr><td colspan="3" class="muted">No employees yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>Recent Flights</h3>
    <table>
      <thead>
        <tr><th>Flight</th><th>Date</th><th>Status</th></tr>
      </thead>
      <tbody>
        {% for flight in recent_flights %}
          <tr>
            <td>{{ flight.flight_number }}</td>
            <td>{{ flight.date }}</td>
            <td>{{ flight.status or 'Scheduled' }}</td>
          </tr>
        {% else %}
          <tr><td colspan="3" class="muted">No flights yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>Recent Audit</h3>
    <table>
      <thead>
        <tr><th>When</th><th>Action</th><th>Description</th></tr>
      </thead>
      <tbody>
        {% for entry in recent_audit %}
          <tr>
            <td>{{ entry.timestamp.strftime('%Y-%m-%d %H:%M') if entry.timestamp else '' }}</td>
            <td>{{ entry.action }}</td>
            <td>{{ entry.description or '-' }}</td>
          </tr>
        {% else %}
          <tr><td colspan="3" class="muted">No audit events yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
